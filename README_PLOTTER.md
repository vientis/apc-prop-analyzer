# Propeller Characteristic Plotter (`char_plotter.py`)

## Overview

The `char_plotter.py` script provides visualization capabilities for propeller performance data generated by `characteristic_generator.py`. It creates publication-quality plots showing thrust, torque, and power characteristics as functions of RPM for specified flight conditions.

## Features

- **Interactive Selection**: Choose from available propellers and flight speeds
- **Automatic Curve Fitting**: Second-order polynomial fits for thrust and torque curves
- **Data Validation**: Closest-match selection if exact flight speed not available
- **Flexible Output**: Display plots interactively or save to files
- **Comprehensive Error Handling**: Robust input validation and error messages
- **Batch Processing**: Programmatic interface for processing multiple scenarios

## Quick Start

### Interactive Mode
```bash
python char_plotter.py
```

### Get Help
```bash
python char_plotter.py --help
```

### Test Installation
```bash
python test_char_plotter.py
```

## Requirements

The script requires the following Python packages:
- `matplotlib` - for plotting
- `scipy` - for curve fitting
- `numpy` - for numerical operations
- `pandas` - for data handling (inherited from characteristic_generator.py)

## Input Data Format

The script loads `.pickle` files from `reformatted_data/full-characteristics/` containing:

- **Dictionary Structure**: Keys are flight speeds (0-100 m/s)
- **DataFrames**: Each speed contains RPM vs. performance data
- **Columns**: `rpm`, `T` (thrust), `Q` (torque), plus aerodynamic coefficients

## Output

The plotter generates three vertically-stacked subplots:

1. **Top Plot**: Thrust (N) vs RPM with second-order polynomial fit
2. **Middle Plot**: Torque (Nm) vs RPM with second-order polynomial fit
3. **Bottom Plot**: Shaft Power (W) vs RPM with second-order polynomial fit

### Curve Fitting

All three plots include best-fit curves using the equation:
```
f(RPM) = a×RPM² + b×RPM + c
```

**Intelligent Curve Fitting for Maximum Accuracy**: 
- **Smart Range Selection**: Fitting starts from the first non-zero RPM point and extends to the maximum mechanical RPM (190,000 ÷ diameter in inches)
- **Negative Value Preservation**: Natural curves extending below zero are maintained, properly showing the drag regime at low RPM/high flight speeds
- **Extrapolation Exclusion**: High RPM extrapolated data points are excluded from fitting but still displayed

Data points are visually distinguished:
- **Gray squares**: Zero RPM point (displayed but not fitted)
- **Fitted data** (darker colors): Used for curve fitting (first non-zero RPM to Max RPM)  
- **Extrapolated data** (lighter colors): Displayed but excluded from fitting (> Max RPM)

Coefficients are displayed in the plot legends for reference.

## Available Propellers

Currently available propeller models (examples):
- D10P10B2T, D10P10B2TE, D10P12B2TWE
- D10P4-5B2TMR, D10P7B2TE, D10P8B2TE  
- D14P10B2TE, D14P4-7B2TSF, D14P8-5B2TE
- And more...

Run the script interactively to see the complete list.

## Example Usage

### Basic Visualization
```python
from char_plotter import load_propeller_data, plot_characteristics

# Load propeller data
data = load_propeller_data('D10P12B2TWE')

# Plot all three characteristics at 25 m/s flight speed
plot_characteristics(data, 25, 'D10P12B2TWE')
```

### Save Plot to File
```python
# Save instead of displaying
plot_characteristics(data, 25, 'D10P12B2TWE', 
                   save_plot=True, output_dir='my_plots')
```

### Find Available Options
```python
from char_plotter import find_available_propellers

propellers = find_available_propellers()
print(f"Available propellers: {propellers}")
```

## Error Handling

The script handles various error conditions:

- **Missing Data Files**: Clear message if pickle files not found
- **Invalid Propeller Names**: Suggests available alternatives
- **Flight Speed Mismatch**: Automatically selects closest available speed
- **Curve Fitting Failures**: Continues plotting data points if fitting fails
- **User Interruption**: Graceful handling of Ctrl+C

## Integration with Analysis Workflow

1. **Data Generation**: Run `characteristic_generator.py` to create pickle files
2. **Visualization**: Use `char_plotter.py` to visualize specific conditions  
3. **Analysis**: Examine thrust/torque curves for design decisions
4. **Documentation**: Save plots for reports and presentations

For detailed usage examples and advanced features, see `PLOTTER_USAGE.md`.

## Files Created

- `char_plotter.py` - Main visualization script
- `demo_char_plotter.py` - Demonstration script
- `test_char_plotter.py` - Test suite
- `PLOTTER_USAGE.md` - Detailed usage examples
- `README_PLOTTER.md` - This documentation